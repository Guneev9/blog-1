---
title: Distributions
author: ''
date: '2018-02-28'
slug: distributions
categories:
  - data analysis
tags:
  - data analysis
  - rstats
  - statistics
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(extraDistr)
library(tidyverse)
#library(plotly)
```

## Distributions
```{r}
#helper theme for common visualizations
ditch_the_axes <- theme(
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  panel.border = element_blank(),
  panel.grid = element_blank(),
  axis.title = element_blank()
  )
```
### Histograms
One of the best ways to describe a variable is to report the values that appear in the dataset and how many times each value appears. This description is called the distribution of the variable.
The most common representation of a distribution is a histogram, which is a graph that shows the frequency of each value. In this context, "frequency" means the number of times the value appears.

When you start working with a new dataset, we suggest you explore the variables you are planning to use one at a time, and a good way to start is by looking at histograms.

We transformed agepreg from centiyears to years, and combined birthwgt_lb and birthwgt_oz into a single quantity, totalwgt_lb. In this section we use these variables to demonstrate some features of histograms.

We start by reading the data and selecting records for live births:
```{r}
live <- femPregCleaned %>%
  filter(outcome==1)
```
Next we generate and plot the histogram of birthwgt_lb for live births.
```{r}
live %>%
  ggplot(mapping = aes(birthwgt_lb)) + 
  geom_histogram(bins = 16, color = 'black', fill='light blue', na.rm = TRUE) +
  labs(x = "pounds", y="Frequency")
```
The most common value, called the mode, is 7 pounds. The distribution is approximately bell-shaped, which is the shape of the normal distribution, also called a Gaussian distribution. But unlike a true normal distribution, this distribution is asymmetric; it has a tail that extends farther to the left than to the right.

Let's look at the histogram for birthwgt_oz:
```{r}
live %>%
  ggplot(mapping = aes(birthwgt_oz)) + 
  geom_histogram(bins = 16, color = 'black', fill='light blue', na.rm = TRUE) +
  labs(x = "ounces", y="Frequency")
```
In theory we expect this distribution to be uniform; that is, all values should have the same frequency. In fact, 0 is more common than the other values, and 1 and 15 are less common, probably because respondents round off birth weights that are close to an integer value.

Let's look at the histogram for agepreg:
```{r}
live %>%
  ggplot(mapping = aes(agepreg)) + 
  geom_histogram(bins = 45, color = 'black', fill='light blue', na.rm = TRUE) +
  labs(x = "years", y="Frequency")
```
The mode is 21 years. The distribution is very roughly bell-shaped, but in this case the tail extends farther to the right than left; most mothers are in their 20s, fewer in their 30s.

Let's look at the prglength:
```{r}
live %>%
  ggplot(mapping = aes(prglngth)) + 
  geom_histogram(bins = 50, color = 'black', fill='light blue', na.rm = TRUE) +
  labs(x = "weeks", y="Frequency")
```
By far the most common value is 39 weeks. The left tail is longer than the right; early babies are common, but pregnancies seldom go past 43 weeks, and doctors often intervene if they do.

### Outliers
Looking at histograms, it is easy to identify the most common values and the shape of the distribution, but rare values are not always visible. Before going on, it is a good idea to check for outliers, which are extreme values that might be errors in measurement and recording, or might be accurate reports of rare events.

```{r}
live['prglngth'] %>%
  distinct %>% 
  top_n(-10) %>%
  arrange(prglngth)
```
In the list of pregnancy lengths for live births, the 10 lowest values are [0, 4, 9, 13, 17, 18, 19, 20, 21, 22]. Values below 10 weeks are certainly errors; the most likely explanation is that the outcome was not coded correctly. Values higher than 30 weeks are probably legitimate. Between 10 and 30 weeks, it is hard to be sure; some values are probably errors, but some represent premature babies.

On the other end of the range, the highest values are:
```{r}
live['prglngth'] %>%
  distinct %>% 
  top_n(7) %>%
  arrange(prglngth)
```
Most doctors recommend induced labor if a pregnancy exceeds 42 weeks, so some of the longer values are surprising. In particular, 50 weeks seems medically unlikely.

The best way to handle outliers depends on "domain knowledge"; that is, information about where the data come from and what they mean. And it depends on what analysis you are planning to perform.
In this example, the motivating question is whether first babies tend to be early (or late). When people ask this question, they are usually interested in full-term pregnancies, so for this analysis we will focus on pregnancies longer than 27 weeks.
### First babies
Now we can compare the distribution of pregnancy lengths for first babies and others. We divide the data of live births using birthord to create a new column birthNumber, and compute their histograms:
```{r}
live['birthNumber'] <- if_else(live$birthord==1, 'first', 'other')
```

```{r}
live %>%
  ggplot(aes(x=prglngth, fill=birthNumber)) + 
  geom_histogram(bins=20, position="dodge", na.rm = TRUE, color='black') +
  labs(x="Weeks", y="Frequency") + 
  theme(legend.position = c(0.2, 0.7)) + 
  xlim(27, 46)
```
Histograms are useful because they make the most frequent values immediately apparent. But they are not the best choice for comparing two distributions. In this example, there are fewer "first babies" than "others," so some of the apparent differences in the histograms are due to sample sizes. In the next chapter we address this problem using probability mass functions.

### Effect Size
An effect size is a summary statistic intended to describe the size of an effect. For example, to describe the difference between two groups, one obvious choice is the difference in the means.
Mean pregnancy length for first babies is 38.601; for other babies it is 38.523. The difference is 0.078 weeks, which works out to 13 hours. As a fraction of the typical pregnancy length, this difference is about 0.2%. 
If we assume this estimate is accurate, such a difference would have no practical consequences. In fact, without observing a large number of pregnancies, it is unlikely that anyone would notice this difference at all.
Another way to convey the size of the effect is to compare the difference between groups to the variability within groups. Cohen's d is a statistic intended to do that; it is defined
d = (_x1_ - _x2_)/s
where _x1_ and _x2_ are the means of the groups and s is the "pooled standard
deviation".
```{r}
CohenEffectSize <- function(group1, group2){
  diff = mean(group1, na.rm = TRUE) - mean(group2, na.rm = TRUE)
  
  var1 = var(group1, na.rm=TRUE)
  var2 = var(group2, na.rm=TRUE)
  n1 = length(group1)
  n2 = length(group2)
  
  pooled_var = (n1*var1 + n2*var2)/(n1+n2)
  d = diff/sqrt(pooled_var)
  return (d)
}
```

Let's look at the effect size for difference in totalwgt_lb for first babies vs other babies. 
```{r}
firstBirthWgt <- live %>%
  filter(birthord==1) %>%
  .$totalwgt_lb

othersBirthWgt <- live %>%
  filter(birthord!=1) %>%
  .$totalwgt_lb
CohenEffectSize(firstBirthWgt, othersBirthWgt)
```