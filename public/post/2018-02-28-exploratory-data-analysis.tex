\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Exploratory Data Analysis},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}
  \title{Exploratory Data Analysis}
  \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
  \author{}
  \preauthor{}\postauthor{}
  \predate{\centering\large\emph}
  \postdate{\par}
  \date{2018-02-28}


\begin{document}
\maketitle

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{library}\NormalTok{(ggplot2)}
\KeywordTok{library}\NormalTok{(extraDistr)}
\KeywordTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages ---------------------------------------------------------- tidyverse 1.2.1 --
\end{verbatim}

\begin{verbatim}
## √ tibble  1.4.2     √ purrr   0.2.4
## √ tidyr   0.8.0     √ dplyr   0.7.4
## √ readr   1.1.1     √ stringr 1.3.0
## √ tibble  1.4.2     √ forcats 0.3.0
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
## x purrr::rdunif() masks extraDistr::rdunif()
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#library(plotly)}
\end{Highlighting}
\end{Shaded}

The data source is obtained from
\url{https://www.cdc.gov/nchs/nsfg/nsfg_cycle6.htm} This contains fixed
width files, and stata dictionaries consisting of columns for the data
files

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#helper function to parse Stata dictionary}
\NormalTok{dct.parser <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(dct, }\DataTypeTok{includes =} \KeywordTok{c}\NormalTok{(}\StringTok{"StartPos"}\NormalTok{, }\StringTok{"StorageType"}\NormalTok{, }\StringTok{"ColName"}\NormalTok{, }
                                         \StringTok{"ColWidth"}\NormalTok{, }\StringTok{"VarLabel"}\NormalTok{),}
                       \DataTypeTok{preview =} \OtherTok{FALSE}\NormalTok{) \{}
\NormalTok{  temp <-}\StringTok{ }\KeywordTok{readLines}\NormalTok{(dct)}
\NormalTok{  temp <-}\StringTok{ }\NormalTok{temp[}\KeywordTok{grepl}\NormalTok{(}\StringTok{"_column"}\NormalTok{, temp)]}
  
  \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{isTRUE}\NormalTok{(preview)) \{}
    \KeywordTok{head}\NormalTok{(temp)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{    possibilities <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"StartPos"}\NormalTok{, }\StringTok{"StorageType"}\NormalTok{, }
                       \StringTok{"ColName"}\NormalTok{, }\StringTok{"ColWidth"}\NormalTok{, }\StringTok{"VarLabel"}\NormalTok{)}
\NormalTok{    classes <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"numeric"}\NormalTok{, }\StringTok{"character"}\NormalTok{, }\StringTok{"}
\StringTok{                 character"}\NormalTok{, }\StringTok{"numeric"}\NormalTok{, }\StringTok{"character"}\NormalTok{)}
\NormalTok{    pattern <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DataTypeTok{StartPos =} \StringTok{".*}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{(([0-9 ]+)}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{)"}\NormalTok{,}
                 \DataTypeTok{StorageType =} \StringTok{"(byte|int|long|float|double|str[0-9]+)"}\NormalTok{,}
                 \DataTypeTok{ColName =} \StringTok{"(.*)"}\NormalTok{,}
                 \DataTypeTok{ColWidth =} \StringTok{"%([0-9.]+)[a-z]+"}\NormalTok{,}
                 \DataTypeTok{VarLabel =} \StringTok{"(.*)"}\NormalTok{)}
    
\NormalTok{    mymatch <-}\StringTok{ }\KeywordTok{match}\NormalTok{(includes, possibilities)}
    
\NormalTok{    pattern <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\KeywordTok{paste}\NormalTok{(pattern[mymatch], }
                           \DataTypeTok{collapse =}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{s+"}\NormalTok{), }\StringTok{"$"}\NormalTok{, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{)    }
    
\NormalTok{    metadata <-}\StringTok{ }\KeywordTok{setNames}\NormalTok{(}\KeywordTok{lapply}\NormalTok{(}\KeywordTok{seq_along}\NormalTok{(mymatch), }\ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{      out <-}\StringTok{ }\KeywordTok{gsub}\NormalTok{(pattern, }\KeywordTok{paste}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{"}\NormalTok{, x, }\DataTypeTok{sep =} \StringTok{""}\NormalTok{), temp)}
\NormalTok{      out <-}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{"^}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{s+|}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{s+$"}\NormalTok{, }\StringTok{""}\NormalTok{, out)}
\NormalTok{      out <-}\StringTok{ }\KeywordTok{gsub}\NormalTok{(}\StringTok{'}\CharTok{\textbackslash{}"}\StringTok{'}\NormalTok{, }\StringTok{""}\NormalTok{, out, }\DataTypeTok{fixed =} \OtherTok{TRUE}\NormalTok{)}
      \KeywordTok{class}\NormalTok{(out) <-}\StringTok{ }\NormalTok{classes[mymatch][x] ; out \}), }
\NormalTok{                         possibilities[mymatch])}
    
\NormalTok{    implicit.dec <-}\StringTok{ }\KeywordTok{grepl}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{.[1-9]"}\NormalTok{, metadata[[}\StringTok{"ColWidth"}\NormalTok{]])}
    \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{any}\NormalTok{(implicit.dec)) \{}
      \KeywordTok{message}\NormalTok{(}\StringTok{"Some variables may need to be corrected for implicit decimals. }
\StringTok{              Try 'MESSAGES(output_from_dct.parser)' for more details."}\NormalTok{)}
\NormalTok{      metadata[[}\StringTok{"Decimals"}\NormalTok{]] <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\KeywordTok{length}\NormalTok{(metadata[[}\StringTok{"ColWidth"}\NormalTok{]]))}
\NormalTok{      metadata[[}\StringTok{"Decimals"}\NormalTok{]][implicit.dec] <-}
\StringTok{        }\KeywordTok{as.numeric}\NormalTok{(}\KeywordTok{gsub}\NormalTok{(}\StringTok{"[0-9]+}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{."}\NormalTok{, }\StringTok{""}\NormalTok{, }
\NormalTok{                        metadata[[}\StringTok{"ColWidth"}\NormalTok{]][implicit.dec]))}
\NormalTok{      metadata[[}\StringTok{"ColWidth"}\NormalTok{]] <-}\StringTok{ }\KeywordTok{floor}\NormalTok{(}\KeywordTok{as.numeric}\NormalTok{(metadata[[}\StringTok{"ColWidth"}\NormalTok{]]))}
\NormalTok{    \}}
    
\NormalTok{    metadata[[}\StringTok{"ColName"}\NormalTok{]] <-}\StringTok{ }\KeywordTok{make.names}\NormalTok{(}
      \KeywordTok{gsub}\NormalTok{(}\StringTok{"}\CharTok{\textbackslash{}\textbackslash{}}\StringTok{s"}\NormalTok{, }\StringTok{""}\NormalTok{, metadata[[}\StringTok{"ColName"}\NormalTok{]]))}
    
\NormalTok{    metadata <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(metadata)}
    
    \ControlFlowTok{if}\NormalTok{ (}\StringTok{"StorageType"} \OperatorTok{%in%}\StringTok{ }\NormalTok{includes) \{}
\NormalTok{      metadata <-}\StringTok{ }
\StringTok{        }\KeywordTok{within}\NormalTok{(metadata, \{}
\NormalTok{          colClasses <-}\StringTok{ }\KeywordTok{ifelse}\NormalTok{(}
\NormalTok{            StorageType }\OperatorTok{==}\StringTok{ "byte"}\NormalTok{, }\StringTok{"raw"}\NormalTok{,}
            \KeywordTok{ifelse}\NormalTok{(StorageType }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"double"}\NormalTok{, }\StringTok{"long"}\NormalTok{, }\StringTok{"float"}\NormalTok{), }
                   \StringTok{"numeric"}\NormalTok{, }
                   \KeywordTok{ifelse}\NormalTok{(StorageType }\OperatorTok{==}\StringTok{ "int"}\NormalTok{, }\StringTok{"integer"}\NormalTok{,}
                          \KeywordTok{ifelse}\NormalTok{(}\KeywordTok{substr}\NormalTok{(StorageType, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{) }\OperatorTok{==}\StringTok{ "str"}\NormalTok{, }
                                 \StringTok{"character"}\NormalTok{, }\OtherTok{NA}\NormalTok{))))}
\NormalTok{        \})}
\NormalTok{    \}}
    \ControlFlowTok{if}\NormalTok{ (}\KeywordTok{any}\NormalTok{(implicit.dec)) \{}
      \KeywordTok{attr}\NormalTok{(metadata, }\StringTok{"MESSAGE"}\NormalTok{) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%s"}\NormalTok{, }\KeywordTok{paste}\NormalTok{(}
        \StringTok{"Some variables might need to be corrected for implicit decimals. }
\StringTok{        A variable, 'Decimals', has been created in the metadata that}
\StringTok{        indicates the number of decimal places the variable should hold. }
\StringTok{        To correct the output, try (where your stored output is 'mydf'): }
\StringTok{        }
\StringTok{        lapply(seq_along(mydf[!is.na(Decimals)]), }
\StringTok{        function(x) mydf[!is.na(Decimals)][x]}
\StringTok{        / 10^Decimals[!is.na(Decimals)][x])}
\StringTok{        }
\StringTok{        The variables in question are:}
\StringTok{        "}\NormalTok{)), }\KeywordTok{sprintf}\NormalTok{(}\StringTok{"%s"}\NormalTok{, metadata[[}\StringTok{"ColName"}\NormalTok{]][}\OperatorTok{!}\KeywordTok{is.na}\NormalTok{(metadata[[}\StringTok{"Decimals"}\NormalTok{]])]))}
            \KeywordTok{class}\NormalTok{(}\KeywordTok{attr}\NormalTok{(metadata, }\StringTok{"MESSAGE"}\NormalTok{)) <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}
                \StringTok{"MESSAGE"}\NormalTok{, }\KeywordTok{class}\NormalTok{(}\KeywordTok{attr}\NormalTok{(metadata, }\StringTok{"MESSAGE"}\NormalTok{)))}
\NormalTok{        \}}
        \KeywordTok{attr}\NormalTok{(metadata, }\StringTok{"original.dictionary"}\NormalTok{) <-}\StringTok{ }
\StringTok{            }\KeywordTok{c}\NormalTok{(dct, }\KeywordTok{basename}\NormalTok{(dct))}
\NormalTok{        metadata}
\NormalTok{    \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

We can read the coulmns from 2002FemPreg.dct and use those columns to
import the data from the fixed width file 2002FemPreg.dat

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{femPreg2002columns <-}\StringTok{ }\KeywordTok{dct.parser}\NormalTok{(}\StringTok{'~/Documents/CodeWork/ThinkStats2/code/2002FemPreg.dct'}\NormalTok{)}
\NormalTok{femPreg2002 <-}\StringTok{ }\KeywordTok{read.fwf}\NormalTok{(}\StringTok{'~/Documents/CodeWork/ThinkStats2/code/2002FemPreg.dat'}\NormalTok{, }\DataTypeTok{widths =}\NormalTok{ femPreg2002columns}\OperatorTok{$}\NormalTok{ColWidth, }\DataTypeTok{col.names =}\NormalTok{ femPreg2002columns}\OperatorTok{$}\NormalTok{ColName)}
\end{Highlighting}
\end{Shaded}

Taking a look at the data

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{head}\NormalTok{(femPreg2002)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   caseid pregordr howpreg_n howpreg_p moscurrp nowprgdk pregend1 pregend2
## 1      1        1        NA        NA       NA       NA        6       NA
## 2      1        2        NA        NA       NA       NA        6       NA
## 3      2        1        NA        NA       NA       NA        5       NA
## 4      2        2        NA        NA       NA       NA        6       NA
## 5      2        3        NA        NA       NA       NA        6       NA
## 6      6        1        NA        NA       NA       NA        6       NA
##   nbrnaliv multbrth cmotpreg prgoutcome cmprgend flgdkmo1 cmprgbeg
## 1        1       NA       NA          1     1093       NA     1084
## 2        1       NA       NA          1     1166       NA     1157
## 3        3        5       NA          1     1156       NA     1147
## 4        1       NA       NA          1     1198       NA     1189
## 5        1       NA       NA          1     1204       NA     1195
## 6        1       NA       NA          1     1074       NA     1065
##   ageatend hpageend gestasun_m gestasun_w wksgest mosgest dk1gest dk2gest
## 1       NA       NA          9          0      39       9      NA      NA
## 2       NA       NA          9          0      39       9      NA      NA
## 3       NA       NA          0         39      39       9      NA      NA
## 4       NA       NA          0         39      39       9      NA      NA
## 5       NA       NA          0         39      39       9      NA      NA
## 6       NA       NA          0         38      38       9      NA      NA
##   dk3gest bpa_bdscheck1 bpa_bdscheck2 bpa_bdscheck3 babysex birthwgt_lb
## 1      NA             0            NA            NA       1           8
## 2      NA             0            NA            NA       2           7
## 3      NA             0            NA            NA       1           9
## 4      NA             0            NA            NA       2           7
## 5      NA             0            NA            NA       2           6
## 6      NA             0            NA            NA       1           8
##   birthwgt_oz lobthwgt babysex2 birthwgt_lb2 birthwgt_oz2 lobthwgt2
## 1          13       NA       NA           NA           NA        NA
## 2          14       NA       NA           NA           NA        NA
## 3           2       NA        2            2            0        NA
## 4           0       NA       NA           NA           NA        NA
## 5           3       NA       NA           NA           NA        NA
## 6           9       NA       NA           NA           NA        NA
##   babysex3 birthwgt_lb3 birthwgt_oz3 lobthwgt3 cmbabdob kidage hpagelb
## 1       NA           NA           NA        NA     1093    138      37
## 2       NA           NA           NA        NA     1166     65      42
## 3        1            1            4        NA     1156     75      24
## 4       NA           NA           NA        NA     1198     33      25
## 5       NA           NA           NA        NA     1204     27      25
## 6       NA           NA           NA        NA     1074    157      27
##   birthplc paybirth1 paybirth2 paybirth3 knewpreg trimestr ltrimest
## 1       NA        NA        NA        NA       NA       NA       NA
## 2        1         1         2        NA        2       NA       NA
## 3       NA        NA        NA        NA       NA       NA       NA
## 4        1         3        NA        NA        3       NA       NA
## 5        1         3        NA        NA        2       NA       NA
## 6       NA        NA        NA        NA       NA       NA       NA
##   priorsmk postsmks npostsmk getprena bgnprena pnctrim lpnctri workpreg
## 1       NA       NA       NA       NA       NA      NA      NA       NA
## 2        0        5       NA        1        4      NA      NA        5
## 3       NA       NA       NA       NA       NA      NA      NA       NA
## 4        0        5       NA        1        4      NA      NA        5
## 5        0        5       NA        1        4      NA      NA        1
## 6       NA       NA       NA       NA       NA      NA      NA       NA
##   workborn didwork matweeks weeksdk matleave matchfound livehere alivenow
## 1       NA      NA       NA      NA       NA          1       NA       NA
## 2       NA      NA       NA      NA       NA          5        1       NA
## 3       NA      NA       NA      NA       NA          5        1       NA
## 4       NA      NA       NA      NA       NA          5        5        1
## 5        5       2       NA      NA       NA          5        5        1
## 6       NA      NA       NA      NA       NA          1       NA       NA
##   cmkidied cmkidlft lastage wherenow legagree parenend anynurse fedsolid
## 1       NA       NA      NA       NA       NA       NA        5       NA
## 2       NA       NA      NA       NA       NA       NA        1       NA
## 3       NA       NA      NA       NA       NA       NA        5       NA
## 4       NA     1205       7        2       NA        1        5       NA
## 5       NA     1221      17        2       NA        1        5       NA
## 6       NA       NA      NA       NA       NA       NA        1       NA
##   frsteatd_n frsteatd_p frsteatd quitnurs ageqtnur_n ageqtnur_p ageqtnur
## 1         NA         NA       NA       NA         NA         NA       NA
## 2          4          1        4       NA         20          1       20
## 3         NA         NA       NA       NA         NA         NA       NA
## 4         NA         NA       NA       NA         NA         NA       NA
## 5         NA         NA       NA       NA         NA         NA       NA
## 6          1          1        1       NA          2          1        2
##   matchfound2 livehere2 alivenow2 cmkidied2 cmkidlft2 lastage2 wherenow2
## 1          NA        NA        NA        NA        NA       NA        NA
## 2          NA        NA        NA        NA        NA       NA        NA
## 3           5         5         5      1156        NA        0        NA
## 4          NA        NA        NA        NA        NA       NA        NA
## 5          NA        NA        NA        NA        NA       NA        NA
## 6          NA        NA        NA        NA        NA       NA        NA
##   legagree2 parenend2 anynurse2 fedsolid2 frsteatd_n2 frsteatd_p2
## 1        NA        NA        NA        NA          NA          NA
## 2        NA        NA        NA        NA          NA          NA
## 3        NA        NA        NA        NA          NA          NA
## 4        NA        NA        NA        NA          NA          NA
## 5        NA        NA        NA        NA          NA          NA
## 6        NA        NA        NA        NA          NA          NA
##   frsteatd2 quitnurs2 ageqtnur_n2 ageqtnur_p2 ageqtnur2 matchfound3
## 1        NA        NA          NA          NA        NA          NA
## 2        NA        NA          NA          NA        NA          NA
## 3        NA        NA          NA          NA        NA           5
## 4        NA        NA          NA          NA        NA          NA
## 5        NA        NA          NA          NA        NA          NA
## 6        NA        NA          NA          NA        NA          NA
##   livehere3 alivenow3 cmkidied3 cmkidlft3 lastage3 wherenow3 legagree3
## 1        NA        NA        NA        NA       NA        NA        NA
## 2        NA        NA        NA        NA       NA        NA        NA
## 3         5         5      1156        NA        0        NA        NA
## 4        NA        NA        NA        NA       NA        NA        NA
## 5        NA        NA        NA        NA       NA        NA        NA
## 6        NA        NA        NA        NA       NA        NA        NA
##   parenend3 anynurse3 fedsolid3 frsteatd_n3 frsteatd_p3 frsteatd3
## 1        NA        NA        NA          NA          NA        NA
## 2        NA        NA        NA          NA          NA        NA
## 3        NA        NA        NA          NA          NA        NA
## 4        NA        NA        NA          NA          NA        NA
## 5        NA        NA        NA          NA          NA        NA
## 6        NA        NA        NA          NA          NA        NA
##   quitnurs3 ageqtnur_n3 ageqtnur_p3 ageqtnur3 cmlastlb cmfstprg cmlstprg
## 1        NA          NA          NA        NA     1166     1093     1166
## 2        NA          NA          NA        NA     1166     1093     1166
## 3        NA          NA          NA        NA     1204     1156     1204
## 4        NA          NA          NA        NA     1204     1156     1204
## 5        NA          NA          NA        NA     1204     1156     1204
## 6        NA          NA          NA        NA     1112     1074     1112
##   cmintstr cmintfin cmintstrop cmintfinop cmintstrcr cmintfincr evuseint
## 1      920     1093         NA         NA         NA         NA        1
## 2     1093     1166       1166       1231         NA         NA        1
## 3     1153     1156         NA         NA         NA         NA        5
## 4     1156     1198         NA         NA         NA         NA       NA
## 5     1198     1204       1204       1231         NA         NA       NA
## 6     1032     1074         NA         NA         NA         NA        1
##   stopduse whystopd whatmeth01 whatmeth02 whatmeth03 whatmeth04 resnouse
## 1        1        1         NA         NA         NA         NA       NA
## 2        1        1         NA         NA         NA         NA       NA
## 3       NA       NA         NA         NA         NA         NA        5
## 4       NA       NA          4         NA         NA         NA       NA
## 5       NA       NA          4         NA         NA         NA       NA
## 6        5       NA          1         NA         NA         NA       NA
##   wantbold probbabe cnfrmno wantbld2 timingok toosoon_n toosoon_p wthpart1
## 1       NA       NA      NA       NA        3        NA        NA        1
## 2       NA       NA      NA       NA        3        NA        NA        1
## 3        5       NA      NA       NA       NA        NA        NA       NA
## 4        5       NA      NA       NA       NA        NA        NA       NA
## 5        5       NA      NA       NA       NA        NA        NA       NA
## 6        1       NA      NA       NA        2        NA        NA        1
##   wthpart2 feelinpg hpwnold timokhp cohpbeg cohpend tellfath whentell
## 1       NA       NA       1       2      NA      NA        1        1
## 2       NA       NA       1       4      NA      NA        1        1
## 3        4       NA       5      NA       5       5        1        1
## 4        4        3       1       1       5       5        1        1
## 5        4        5       5      NA       1       1       NA       NA
## 6       NA       NA       1       1      NA      NA        1        1
##   tryscale wantscal whyprg1 whyprg2 whynouse1 whynouse2 whynouse3 anyusint
## 1       NA       NA      NA      NA        NA        NA        NA        5
## 2       NA       NA      NA      NA        NA        NA        NA        5
## 3       NA       NA      NA      NA        NA        NA        NA        5
## 4        2        3       2      NA        NA        NA        NA        1
## 5        4        4       2      NA        NA        NA        NA        1
## 6       NA       NA      NA      NA        NA        NA        NA        5
##   prglngth outcome birthord datend agepreg datecon agecon fmarout5
## 1       39       1        1   1093    3316    1084   3241        1
## 2       39       1        2   1166    3925    1157   3850        1
## 3       39       1        1   1156    1433    1147   1358        5
## 4       39       1        2   1198    1783    1189   1708        5
## 5       39       1        3   1204    1833    1195   1758        5
## 6       38       1        1   1074    2700    1065   2625        1
##   pmarpreg rmarout6 fmarcon5 learnprg pncarewk paydeliv lbw1 bfeedwks
## 1        2        1        1       NA       NA       NA    2      995
## 2        2        1        1        2        4        3    2       87
## 3        1        6        5       NA       NA       NA    2      995
## 4        1        6        5        3        4        4    2      995
## 5        1        6        5        2        4        4    2      995
## 6        2        1        1       NA       NA       NA    2        9
##   maternlv oldwantr oldwantp wantresp wantpart cmbirth ager agescrn
## 1       NA        1        2        1        2     695   44      44
## 2        0        1        4        1        4     695   44      44
## 3       NA        5        5        5        5     984   20      20
## 4        0        5        3        5        3     984   20      20
## 5        3        5        5        5        5     984   20      20
## 6       NA        2        3        2        3     750   40      40
##   fmarital rmarital educat hieduc race hispanic hisprace rcurpreg pregnum
## 1        1        1     16     12    2        2        2        2       2
## 2        1        1     16     12    2        2        2        2       2
## 3        5        6     11      7    1        2        3        2       3
## 4        5        6     11      7    1        2        3        2       3
## 5        5        6     11      7    1        2        3        2       3
## 6        1        1     18     12    2        2        2        2       3
##   parity insuranc pubassis poverty laborfor religion metro brnout yrstrus
## 1      2        2        2     469        3        2     1      5      NA
## 2      2        2        2     469        3        2     1      5      NA
## 3      5        3        2     100        2        3     1      5      NA
## 4      5        3        2     100        2        3     1      5      NA
## 5      5        3        2     100        2        3     1      5      NA
## 6      3        2        2     216        7        3     1      5      NA
##   prglngth_i outcome_i birthord_i datend_i agepreg_i datecon_i agecon_i
## 1          0         0          0        0         0         0        0
## 2          0         0          0        0         0         0        0
## 3          0         0          0        0         0         0        0
## 4          0         0          0        0         0         0        0
## 5          0         0          0        0         0         0        0
## 6          0         0          0        0         0         0        0
##   fmarout5_i pmarpreg_i rmarout6_i fmarcon5_i learnprg_i pncarewk_i
## 1          0          0          0          0          0          0
## 2          0          0          0          0          0          0
## 3          0          0          0          0          0          0
## 4          0          0          0          0          0          0
## 5          0          0          0          0          0          0
## 6          0          0          0          0          0          0
##   paydeliv_i lbw1_i bfeedwks_i maternlv_i oldwantr_i oldwantp_i wantresp_i
## 1          0      0          0          0          0          0          0
## 2          0      0          0          0          0          0          0
## 3          0      0          0          0          0          0          0
## 4          0      0          0          0          0          0          0
## 5          0      0          0          0          0          0          0
## 6          0      0          0          0          0          0          0
##   wantpart_i ager_i fmarital_i rmarital_i educat_i hieduc_i race_i
## 1          0      0          0          0        0        0      0
## 2          0      0          0          0        0        0      0
## 3          0      0          0          0        0        0      0
## 4          0      0          0          0        0        0      0
## 5          0      0          0          0        0        0      0
## 6          0      0          0          0        0        0      0
##   hispanic_i hisprace_i rcurpreg_i pregnum_i parity_i insuranc_i
## 1          0          0          0         0        0          0
## 2          0          0          0         0        0          0
## 3          0          0          0         0        0          0
## 4          0          0          0         0        0          0
## 5          0          0          0         0        0          0
## 6          0          0          0         0        0          0
##   pubassis_i poverty_i laborfor_i religion_i metro_i  basewgt
## 1          0         0          0          0       0 3410.389
## 2          0         0          0          0       0 3410.389
## 3          0         0          0          0       0 7226.302
## 4          0         0          0          0       0 7226.302
## 5          0         0          0          0       0 7226.302
## 6          0         0          0          0       0 4870.926
##   adj_mod_basewgt  finalwgt secu_p sest cmintvw
## 1        3869.350  6448.271      2    9    1231
## 2        3869.350  6448.271      2    9    1231
## 3        8567.549 12999.542      2   12    1231
## 4        8567.549 12999.542      2   12    1231
## 5        8567.549 12999.542      2   12    1231
## 6        5325.197  8874.441      1   23    1231
\end{verbatim}

We can see a lot of missing values. We'll clean the data for the columns
that we want to analyze.

\subsection{Transformation}\label{transformation}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  agepreg contains the mother's age at the end of the pregnancy. In the
  data file, agepreg is encoded as an integer number of centiyears. So
  the first line divides each element of agepreg by 100, yielding a
  floating-point value in years.
\item
  birthwgt\_lb and birthwgt\_oz contain the weight of the baby, in
  pounds and ounces, for pregnancies that end in live birth. In addition
  it uses several special codes: 97 NOT ASCERTAINED 98 REFUSED 99 DONT
  KNOW Special values encoded as numbers are dangerous because if they
  are not handled properly, they can generate bogus results, like a
  99-pound baby. Assuming that a baby can't be generally more than 20 lb
  at birth, we will replace all other values with NA, as they are NOT
  ASCERTAINED(97), REFUSED(98), DONT KNOW(99), or invalid values.
  Similarly, the age of father has these similar special codes, which we
  will replace by NA
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cleanFemPreg <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(data)\{}
  \CommentTok{# mother's age is encoded in centiyears; convert to years}
\NormalTok{  data[}\StringTok{'agepreg'}\NormalTok{] <-}\StringTok{  }\NormalTok{data[}\StringTok{'agepreg'}\NormalTok{]}\OperatorTok{/}\FloatTok{100.0}
  
  \CommentTok{# birthwgt_lb contains at least one bogus value (51 lbs)}
  \CommentTok{# replace with NaN}
\NormalTok{  data}\OperatorTok{$}\NormalTok{birthwgt_lb[data}\OperatorTok{$}\NormalTok{birthwgt_lb }\OperatorTok{>}\StringTok{ }\DecValTok{20}\NormalTok{] <-}\StringTok{ }\OtherTok{NA}
  
  \CommentTok{# replace 'not ascertained', 'refused', 'don't know' with NA}
\NormalTok{  na_vals =}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{97}\NormalTok{, }\DecValTok{98}\NormalTok{, }\DecValTok{99}\NormalTok{)}
\NormalTok{  data}\OperatorTok{$}\NormalTok{birthwgt_oz[data}\OperatorTok{$}\NormalTok{birthwgt_oz }\OperatorTok{%in%}\StringTok{ }\NormalTok{na_vals] <-}\StringTok{ }\OtherTok{NA}
\NormalTok{  data}\OperatorTok{$}\NormalTok{hpagelb[data}\OperatorTok{$}\NormalTok{hpagelb }\OperatorTok{%in%}\StringTok{ }\NormalTok{na_vals] <-}\StringTok{ }\OtherTok{NA}
  
  \CommentTok{# birthweight is stored in two columns, lbs and oz.}
  \CommentTok{# convert to a single column in lb}
\NormalTok{  data[}\StringTok{'totalwgt_lb'}\NormalTok{] <-}\StringTok{ }\NormalTok{data}\OperatorTok{$}\NormalTok{birthwgt_lb }\OperatorTok{+}\StringTok{ }\NormalTok{(data}\OperatorTok{$}\NormalTok{birthwgt_oz }\OperatorTok{/}\StringTok{ }\FloatTok{16.0}\NormalTok{)}
  
  \KeywordTok{return}\NormalTok{ (data)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{femPregCleaned <-}\StringTok{ }\KeywordTok{cleanFemPreg}\NormalTok{(femPreg2002)}
\end{Highlighting}
\end{Shaded}

\subsubsection{Validation}\label{validation}

One way to validate data is to compute basic statistics and compare them
with published results. For example, the NSFG codebook includes tables
that summarize each variable. Here is the table for outcome, which
encodes the outcome of each pregnancy: value label Total 1 LIVE BIRTH
9148 2 INDUCED ABORTION 1862 3 STILLBIRTH 120 4 MISCARRIAGE 1921 5
ECTOPIC PREGNANCY 190 6 CURRENT PREGNANCY 352

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{femPreg2002 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(outcome) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{Total =} \KeywordTok{length}\NormalTok{(outcome))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: package 'bindrcpp' was built under R version 3.4.4
\end{verbatim}

\begin{verbatim}
## # A tibble: 6 x 2
##   outcome Total
##     <int> <int>
## 1       1  9148
## 2       2  1862
## 3       3   120
## 4       4  1921
## 5       5   190
## 6       6   352
\end{verbatim}

Comparing the results with the published table, it looks like the values
in outcome are correct. Similarly, here is the published table for
birthwgt\_lb value label Total . INAPPLICABLE 4449 0-5 UNDER 6 POUNDS
1125 6 6 POUNDS 2223 7 7 POUNDS 3049 8 8 POUNDS 1889 9-95 9 POUNDS OR
MORE 799

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{femPreg2002 }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(birthwgt_lb) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{summarise}\NormalTok{(}\DataTypeTok{Total =} \KeywordTok{length}\NormalTok{(birthwgt_lb))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 21 x 2
##    birthwgt_lb Total
##          <int> <int>
##  1           0     8
##  2           1    40
##  3           2    53
##  4           3    98
##  5           4   229
##  6           5   697
##  7           6  2223
##  8           7  3049
##  9           8  1889
## 10           9   623
## # ... with 11 more rows
\end{verbatim}

The counts for 6, 7, and 8 pounds check out, and if you add up the
counts for 0-5 and 9-95, they check out, too. But if you look more
closely, you will notice one value that has to be an error, a 51 pound
baby! This has been cleaned in the cleanFemPreg function.

\subsubsection{Interpretation}\label{interpretation}

To work with data effectively, you have to think on two levels at the
same time: the level of statistics and the level of context. As an
example, let's look at the sequence of outcomes for a few respondents.
This example looks up one respondent and prints a list of outcomes for
her pregnancies:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{CASEID =}\StringTok{ }\DecValTok{10229}
\NormalTok{femPregCleaned }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(caseid}\OperatorTok{==}\NormalTok{CASEID) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{.}\OperatorTok{$}\NormalTok{outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4 4 4 4 4 4 1
\end{verbatim}

The outcome code 1 indicates a live birth. Code 4 indicates a
miscarriage; that is, a pregnancy that ended spontaneously, usually with
no known medical cause.

Statistically this respondent is not unusual. Miscarriages are common
and there are other respondents who reported as many or more. But
remembering the context, this data tells the story of a woman who was
pregnant six times, each time ending in miscarriage. Her seventh and
most recent pregnancy ended in a live birth. If we consider this data
with empathy, it is natural to be moved by the story it tells.

Each record in the NSFG dataset represents a person who provided honest
answers to many personal and difficult questions. We can use this data
to answer statistical questions about family life, reproduction, and
health. At the same time, we have an obligation to consider the people
represented by the data, and to afford them respect and gratitude.


\end{document}
